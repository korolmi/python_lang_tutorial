
== Краткий обзор стандартной библиотеки ==

=== Взаимодействие с операционной системой ===

Модуль <tt>os</tt> предоставляет десятки функций для взаимодействия с операционной системой.
<syntaxhighlight lang="python">>>> import os
>>> os.getcwd()                     # возвращает путь к текущему каталогу
'C:\\Python31'
>>> os.system('dir *.txt')          # выполнить указанную команду ОС
...список текстовых файлов, выведенных командой...
0
>>> os.chdir('/server/accesslogs')  # сменить текущий каталог
</syntaxhighlight>

Лучше всего применять <code>import os</code> вместо <code>from os import *</code>. Это предохранит встроенную функцию <code>open()</code> от замещения функцией <code>os.open()</code>, имеющей несколько иное назначение.

В интерактивном режиме встроенные функции <code>dir()</code> и <code>help()</code> помогут разобраться с большими модулями вроде <tt>os</tt>:

<syntaxhighlight lang="python">>>> import os
>>> dir(os)
...список всех атрибутов модуля...
>>> help(os)
...страница руководства по модулю на основе строк документации...
</syntaxhighlight>

Для управления файлами и каталогами удобный высокоуровневый интерфейс предоставляет модуль <tt>shutil</tt>:

<syntaxhighlight lang="python">>>> import shutil
>>> shutil.copyfile('data.db', 'archive.db')         # копировать файл
>>> shutil.move('/build/executables', 'installdir')  # переместить каталог
</syntaxhighlight>

=== Wildcard-шаблоны для имён файлов ===

Модуль <tt>glob</tt> предоставляет функцию для получения списка файлов на основе заданного шаблона:

<syntaxhighlight lang="python">>>> import glob
>>> glob.glob('*.py')
['primes.py', 'random.py', 'quote.py']
</syntaxhighlight>

=== Аргументы командной строки ===

Сценарии общего назначения часто нуждаются в аргументах командной строки. Эти аргументы хранятся в атрибуте <tt>argv</tt> модуля <tt>sys</tt> в виде списка. Например, при запуске <code>python demo.py one two three</code> в командной строке шелла для сценария <tt>demo.py</tt>:

<syntaxhighlight lang="python">import sys
print(sys.argv)
</syntaxhighlight>

будет выведено <code>['demo.py', 'one', 'two', 'three']</code>.

Модуль <tt>getopt</tt> обрабатывает <code>sys.argv</code>, используя соглашения функции <code>getopt()</code> системы Unix.
Более мощную и гибкую обработку аргументов командной строки осуществляет модуль <tt>optparse</tt>.

=== Стандартный вывод. Завершение сценария ===

Модуль <tt>sys</tt> имеет атрибуты <code>stdin</code>, <code>stdout</code> и <code>stderr</code> (для стандартного ввода, вывода и вывода ошибок соответственно). Последний может быть полезен для вывода предупреждений и сообщений об ошибках когда стандартный вывод перенаправлен<ref>''(Прим. перев.)'' разумеется, если стандартный вывод ошибок перенаправлен не был</ref>:

<syntaxhighlight lang="python">>>> sys.stderr.write('Внимание! Файл журнала не найден.\n')
Внимание! Файл журнала не найден.
34
</syntaxhighlight>

Для завершения сценария можно использовать <code>sys.exit()</code>.

=== Сравнение строк по шаблонам ===

Модуль <tt>re</tt> предоставляет инструментарий для работы с регулярными выражениями для нетривиальной обработки текста. С помощью регулярных выражений можно создавать выразительные и оптимизированные решения для поиска и обработки строк.

<syntaxhighlight lang="python">>>> import re
>>> re.findall(r'\bf[a-z]*', 'which foot or hand fell fastest')
['foot', 'fell', 'fastest']
>>> re.sub(r'(\b[a-z]+) \1', r'\1', 'cat in the the hat')
'cat in the hat'
</syntaxhighlight>

Когда требуются более простые возможности, методы строковых объектов предпочтительнее, так как их легче читать и отлаживать:

<syntaxhighlight lang="python">>>> 'чай для двоих'.replace('для', 'на')
'чай на двоих'
</syntaxhighlight>

=== Математические функции ===

Модуль <tt>math</tt> предоставляет доступ к библиотеке языка C для функций над числами с плавающей запятой:

<syntaxhighlight lang="python">>>> import math
>>> math.cos(math.pi / 4)
0.70710678118654757
>>> math.log(1024, 2)
10.0
</syntaxhighlight>

С помощью модуля <tt>random</tt> можно делать случайный выбор:

<syntaxhighlight lang="python">>>> import random
>>> random.choice(['яблоко', 'груша', 'банан'])
'яблоко'
>>> random.sample(range(100), 10)   # выборка без повторений
[30, 83, 16, 4, 8, 81, 41, 50, 18, 33]
>>> random.random()        # случайное число с плавающей запятой
0.17970987693706186
>>> random.randrange(6)    # случайное целое из диапазона range(6)
4
>>> random.sample([1, 2, 3, 4, 5],  3)  # случайные три элемента из списка
[4, 1, 5]

</syntaxhighlight>
Проект SciPy <http://scipy.org> имеет много других модулей для численных расчётов.

=== Протоколы интернет ===

В стандартной библиотеке имеется целый набор модулей для различных сервисов и протоколов интернет. Наиболее употребимыми можно считать <code>urllib.request</code> для получения данных по заданному адресу (URL) и <code>smtplib</code> для отправки сообщений электронной почты:

<syntaxhighlight lang="python">>>> from urllib.request import urlopen
>>> for line in urlopen('http://tycho.usno.navy.mil/cgi-bin/timer.pl'):
...     if 'EST' in line or 'EDT' in line:  # временные зоны
...         print(line)

<BR>Nov. 25, 09:43:32 PM EST

>>> import smtplib
>>> server = smtplib.SMTP('localhost')
>>> server.sendmail('soothsayer@example.org', 'jcaesar@example.org',
... """To: jcaesar@example.org
... From: soothsayer@example.org
...
... Beware the Ides of March.
... """)
>>> server.quit()
</syntaxhighlight>

Заметьте, что второй пример требует почтового сервера на той же машине.

=== Дата и время ===

Модуль <code>datetime</code> предлагает классы для работы с датами и временем как в простых, так и сложных случаях. Кроме поддержки календарной арифметики, реализация обращает особенное внимание на эффективность вычисления составных частей для вывода и дальнейших манипуляций. Модуль также предлагает объекты с поддержкой временных зон.

<syntaxhighlight lang="python"># даты можно легко составлять и выводить в требуемом формате
>>> from datetime import date
>>> now = date.today()
>>> now
datetime.date(2009, 2, 3)
>>> now.strftime("%d.%m.%Y")
'03.02.2009'

# даты поддерживают календарную арифметику
>>> birthday = date(1964, 7, 31)
>>> age = now - birthday
>>> age.days
16258
</syntaxhighlight>

=== Сжатие данных и архивы ===

Наиболее распространённые форматы сжатия и архивации напрямую поддерживаются модулями стандартной библиотеки: <tt>zlib</tt>, <tt>gzip</tt>, <tt>bz2</tt>, <tt>zipfile</tt> и <tt>tarfile</tt>.

<syntaxhighlight lang="python">>>> import zlib
>>> s = "Закрой замок на замок, чтобы замок не замок"
>>> len(bytes(s, "utf-8"))
78
>>> t = zlib.compress(s)
>>> len(t)
54
>>> print(str(zlib.decompress(t), "utf-8"))
Закрой замок на замок, чтобы замок не замок
>>> zlib.crc32(s)
2392363341
</syntaxhighlight>

=== Измерение производительности ===

Некоторым пользователям Python интересно знать относительную производительность различных подходов к решению одной и той же проблемы. Python предлагает инструмент для немедленного ответа на эти вопросы.

Например, очень заманчиво использовать присваивание кортежей вместо традиционного подхода к замене значений переменных местами. Модуль <code>timeit</code> быстро продемонстрирует незначительное превосходство кортежей:

<syntaxhighlight lang="python">>>> from timeit import Timer
>>> Timer('a, b = b, a', 'a=1; b=2').timeit()
0.15707302093505859
>>> Timer('t=a; a=b; b=t', 'a=1; b=2').timeit()
0.19421601295471191
</syntaxhighlight>

В отличие от высокого разрешения модуля <code>timeit</code>, модули <code>profile</code> и <code>pstats</code> предлагают возможность обнаружить критические по времени участки в больших фрагментах кода.

=== Контроль качества ===

Один из подходов к разработке высококачественного программного обеспечения заключается в написании тестов для каждой функции при её разработке и регулярном запуске этих тестов во время всего процесса разработки.

Модуль <code>doctest</code> имеет средства для просмотра модуля и проверки результатов тестов, заложенных в строках документации. Написание теста для функции заключается в копировании и вставке типичного вызова функции и ее результатов в строку документации. Это улучшает документацию, предоставляя пользователю реальный пример, а модуль <code>doctest</code> проверяет, что код соответствует документации.


<syntaxhighlight lang="python">def average(values):
    """Вычисляет среднее арифметическое списка чисел.

    >>> print(average([20, 30, 70]))
    40.0
    """
    return sum(values) / len(values)

import doctest
doctest.testmod()   # автоматически проверяет тесты в документации
</syntaxhighlight>

Модуль <code>unittest</code> не менее прост в использовании чем <code>doctest</code>, но позволяет создавать более полный набор тестов, располагающийся в отдельном файле:

<syntaxhighlight lang="python">import unittest

class TestStatisticalFunctions(unittest.TestCase):

    def test_average(self):
        self.assertEqual(average([20, 30, 70]), 40.0)
        self.assertEqual(round(average([1, 5, 7]), 1), 4.3)
        self.assertRaises(ZeroDivisionError, average, [])
        self.assertRaises(TypeError, average, 20, 30, 70)

unittest.main() # Вызов из командной строки выполняет проверку всех тестов этого модуля

</syntaxhighlight>

=== «Батарейки в комплекте» ===

Python руководствуется философией «батарейки в комплекте». Это можно проследить по сложным и устойчивым к ошибкам возможностям его пакетов побольше. Примеры:

* Модули <code>xmlrpc.client</code> и <code>xmlrpc.server</code> делают реализацию удалённых вызовов почти тривиальной задачей. Несмотря на названия, знания об обработке XML не требуются.

* Пакет <code>email</code> — это библиотека для работы с сообщениями электронной почты, включая MIME и другие основанные на RFC 2822 документы-сообщения. В отличие от <code>smtplib</code> и <code>poplib</code>, которые занимаются непосредственно отправкой и приёмом сообщений, пакет <code>email</code> является полным набором инструментов для построения и декодирования сообщений сложной структуры (включая вложения) и для реализации интернетного кодирования и протокола заголовков.

* Пакеты <code>xml.dom</code> и <code>xml.sax</code> предоставляют ошибко-устойчивую поддержку парсинга XML — этого популярного формата для обмена данными. Аналогично, модуль <code>csv</code> поддерживает чтение и запись в распространённом формате баз данных. Вместе эти модули серьёзно облегчают обмен данными между приложениями на Python и другими приложениями.

* Интернационализация поддерживается благодаря ряду модулей, включая <code>gettext</code>, <code>locale</code> и пакет <code>codecs</code>.

